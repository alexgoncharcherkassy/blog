{% extends '@App/layoutAdmin.html.twig' %}

{% block panel %}

    <div class="panel panel-success">
        <div class="panel-heading" style="margin-bottom: 0">
            <h4>Edit post</h4>
        </div>

        <div class="panel-body">
            {{ tinymce_init() }}
            {% if oldImage is not null %}
                {% if oldImage starts with 'http:' %}
                    <img src="{{ oldImage }}" class="img-thumbnail pull-left" style="width: 460px">
                {% endif %}
                {% if oldImage starts with 'img/' %}
                    <img src="{{ oldImage | imagine_filter('blog_show') }}" class="img-thumbnail pull-left">
                {% endif %}
                {{ form(formDeleteImage[slug], {'attr' : {'style' : 'float:left'}}) }}
            {% endif %}
            {{ form_start(form, {'attr' : {'style' : 'clear : both'}}) }}
            <br/>
            <div>
                {{ form_widget(form.newTags, {'attr' : {'class' : 'ms-tagbox'}}) }}
                {{ form_errors(form.newTags) }}
            </div>
            <hr/>
            <div>
                {{ form_widget(form.newCategory, {'attr' : {'class' : 'ms-categorybox'}}) }}
                {{ form_errors(form.newCategory) }}
            </div>
            <hr/>
            <div>
                {{ form_widget(form.titlePost) }}
                {{ form_errors(form.titlePost) }}
            </div>
            <br/>
            <div>
                {{ form_widget(form.textPost) }}
                {{ form_errors(form.textPost) }}
            </div>
            <br/>
            <div>
                {{ form_widget(form.blog_image) }}
                {{ form_errors(form.blog_image) }}
            </div>
            <br/>
            {{ form_rest(form) }}
            {# <input type="submit" value="Add file" class="jslink">
             <br/>#}
            <br/>
            <input type="submit" VALUE="Save article" class="btn btn-large btn-primary">
            {{ form_end(form) }}
            <div id="del"></div>
        </div>
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script>
        function add() {
            var collectionHolder = $('#app_bundle_post_type_images');
            var prototype = collectionHolder.attr('data-prototype');
            // Sustituye __name__ con el n√∫mero de hijos que tiene el div #nencargo_attachments, es decir, la cantidad de archivos adjuntos que hay.
            var form = prototype.replace(/__name__/g, collectionHolder.children().length);
            $(form).filter('div').first().html($(form).html() + '<a class="delete_link" href="#">Remove</a>');
            collectionHolder.append(form);
        }

        $('input.jslink').click(function (event) {
            event.preventDefault();
            add();
        });

        $(document).on('click', 'a.delete_link', function (event) {
            $(event.currentTarget).parent().remove();
        });

        $(document).ready(function() {
            $('.ms-tagbox').magicSuggest({
                placeholder: 'Enter one or multiple tags',
                data: {{ tags|json_encode|raw }},
                name: 'app_bundle_post_type[newTags]',
                selectionCls: 'custom',
                useZebraStyle: true,
                selectFirst: true,
                value: {{ itemTags|json_encode|raw }},
                valueField: 'id',
                resultsField: 'id',
                displayField: 'tagName'
            });

           var ms = $('.ms-categorybox').magicSuggest({
                placeholder: 'Enter one category',
                data: {{ categories|json_encode|raw }},
                name: 'app_bundle_post_type[newCategory]',
                selectionCls: 'custom',
                useZebraStyle: true,
                selectFirst: true,
                value: {{ itemCategory|json_encode|raw }},
                maxSelection: 1,
                valueField: 'id',
                resultsField: 'id',
                displayField: 'categoryName'
            });

        })
    </script>
{% endblock %}




